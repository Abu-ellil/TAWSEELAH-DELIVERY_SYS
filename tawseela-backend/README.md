# توصيلة | نظام توصيل متكامل - Backend API

نظام توصيل بسيط واحترافي مكوّن من 5 أجزاء مترابطة، هذا هو الجزء الخاص بـ Backend API المركزي (tawseelah-backend).

## الميزات الرئيسية

- نظام مصادقة متكامل باستخدام JWT
- نظام طلبات يدعم الطلبات متعددة المصادر
- إدارة المتاجر والمنتجات
- إدارة السائقين وتتبع المواقع
- إدارة المستخدمين والعناوين
- نظام التقييمات للمستخدمين والسائقين
- نظام العروض والخصومات
- نظام المدفوعات (متكامل مع Stripe)
- نظام دردشة في الوقت الحقيقي بين العملاء والسائقين

## متطلبات النظام

- Node.js (v14 أو أحدث)
- MongoDB (v4 أو أحدث)
- NPM (v6 أو أحدث)

## التثبيت

1. استنساخ المشروع:

```bash
git clone https://github.com/yourusername/tawseelah-backend.git
cd tawseelah-backend
```

2. تثبيت الاعتمادات:

```bash
npm install
```

3. إنشاء ملف `.env` باستخدام النموذج المتوفر:

```bash
cp .env.example .env
```

4. تعديل ملف `.env` بإعدادات البيئة الخاصة بك.

5. تشغيل الخادم:

```bash
# وضع التطوير
npm run dev

# وضع الإنتاج
npm start
```

## هيكل المشروع

```
tawseelah-backend/
├── config/                 # ملفات التكوين
├── middlewares/            # الوسائط المشتركة
├── modules/                # وحدات التطبيق
│   ├── auth/               # وحدة المصادقة
│   ├── chat/               # وحدة الدردشة
│   ├── driver/             # وحدة السائقين
│   ├── order/              # وحدة الطلبات
│   ├── payment/            # وحدة المدفوعات
│   ├── promotion/          # وحدة العروض
│   ├── rating/             # وحدة التقييمات
│   ├── store/              # وحدة المتاجر
│   └── user/               # وحدة المستخدمين
├── uploads/                # مجلد التحميلات
├── logs/                   # سجلات التطبيق
├── utils/                  # أدوات مساعدة
├── app.js                  # تكوين Express
├── server.js               # نقطة الدخول الرئيسية
└── package.json            # تبعيات المشروع
```

## الوحدات

### وحدة المصادقة (Auth Module)

- تسجيل المستخدمين (العملاء، السائقين، مديري المتاجر، المشرفين)
- تسجيل الدخول وإنشاء رموز JWT
- إعادة تعيين كلمة المرور
- تحديث كلمة المرور

### وحدة الطلبات (Order Module)

- إنشاء طلبات من متاجر متعددة
- إضافة عناصر إلى طلب موجود
- تحديثات حالة الطلب في الوقت الحقيقي
- تعيين السائقين للطلبات

### وحدة المتاجر (Store Module)

- إدارة المتاجر (إضافة/تعديل/حذف)
- إدارة المنتجات والقوائم
- ساعات العمل والموقع والتصنيف

### وحدة السائقين (Driver Module)

- تتبع موقع السائق
- إدارة حالة السائق (متاح، في مهمة)
- إحصائيات السائق

### وحدة المستخدمين (User Module)

- دفتر العناوين
- المتاجر المفضلة
- سجل الطلبات

### وحدة التقييمات (Rating Module)

- تقييم المستخدمين والسائقين
- عرض التقييمات
- حساب متوسط التقييمات

### وحدة العروض (Promotion Module)

- الخصومات
- رموز الترويج
- العروض محدودة الوقت

### وحدة المدفوعات (Payment Module)

- تكامل مع Stripe
- إنشاء روابط الدفع
- معالجة إشعارات الدفع

### وحدة الدردشة (Chat Module)

- دردشة في الوقت الحقيقي بين العملاء والسائقين
- إشعارات الرسائل الجديدة
- عرض الرسائل غير المقروءة

## واجهة برمجة التطبيقات (API)

### المصادقة

- `POST /api/auth/register` - تسجيل مستخدم
- `POST /api/auth/login` - تسجيل دخول مستخدم
- `POST /api/auth/driver/register` - تسجيل سائق
- `POST /api/auth/driver/login` - دخول السائق
- `POST /api/auth/store/register` - تسجيل متجر جديد
- `POST /api/auth/store/login` - دخول المتجر

### الطلبات

- `GET /api/orders` - استعراض الطلبات (حسب الدور)
- `POST /api/orders` - إنشاء طلب جديد
- `PATCH /api/orders/:id/status` - تغيير حالة الطلب
- `GET /api/store/orders` - طلبات المتجر
- `POST /api/store/orders/:id/status` - تحديث حالة طلب من طرف المتجر

### التقييمات

- `POST /api/ratings` - إرسال تقييم
- `GET /api/ratings/my-ratings` - الحصول على تقييماتي
- `GET /api/ratings/:userId` - الحصول على تقييمات مستخدم

### أخرى

- `POST /api/notifications/send` - إرسال تنبيه
- `POST /api/payments/initiate` - بدء الدفع

> ⚠️ جميع المسارات محمية بـ JWT ويجب إرسال Header: `Authorization: Bearer <token>`

## التشغيل المحلي

```bash
# Backend API
cd tawseelah-backend
npm install
npm run dev
```
